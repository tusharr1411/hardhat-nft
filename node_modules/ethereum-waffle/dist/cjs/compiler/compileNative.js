"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const child_process_1 = require("child_process");
const buildUitls_1 = require("./buildUitls");
function compileNative(config) {
    return async function compile(sources) {
        const command = createBuildCommand(config);
        const input = JSON.stringify(buildUitls_1.buildInputObject(sources, config.compilerOptions), null, 2);
        return JSON.parse(child_process_1.execSync(command, { input }).toString());
    };
}
exports.compileNative = compileNative;
function createBuildCommand(config) {
    const command = 'solc';
    const params = '--standard-json';
    const customAllowedPaths = (config.allowedPaths || []).map((path) => path_1.resolve(path));
    const allowedPaths = [path_1.resolve(config.sourcesPath), path_1.resolve(config.npmPath), ...customAllowedPaths];
    return `${command} ${params} --allow-paths ${allowedPaths.join(',')}`;
}
exports.createBuildCommand = createBuildCommand;
